function connectWebSocket() {
    // 自动检测服务器地址
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const host = window.location.host;
    const serverUrl = `${protocol}//${host}/api/game`;
    
    try {
        ws = new WebSocket(serverUrl);
        
        ws.onopen = function() {
            console.log('已连接到服务器');
            updateConnectionStatus(true);
            reconnectAttempts = 0;
        };
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            handleServerMessage(data);
        };
        
        ws.onclose = function() {
            console.log('与服务器的连接已断开');
            updateConnectionStatus(false);
            
            // 尝试重新连接
            if (reconnectAttempts < maxReconnectAttempts) {
                setTimeout(() => {
                    reconnectAttempts++;
                    console.log(`尝试重新连接 (${reconnectAttempts}/${maxReconnectAttempts})`);
                    connectWebSocket();
                }, 2000);
            }
        };
        
        ws.onerror = function(error) {
            console.error('WebSocket错误:', error);
            updateConnectionStatus(false);
        };
    } catch (error) {
        console.error('连接失败:', error);
        showMessage("无法连接到服务器，请检查网络连接");
    }
}